---
layout:     post
title:      Paper read "MAD-GAN - Multivariate Anomaly Detection for Time Series Data with Generative Adversarial Networks"
subtitle:   International Conference on Artificial Neural Networks in 2019.
date:       2022-08-14
author:     Yun Wang
header-img: img/post7_bg.jpg
catalog: true
tags:
    - Anomaly Detection
    - Unsupervised Learning
    - Multivariate Time Series
    - GAN
---

## Paper read "MAD-GAN - Multivariate Anomaly Detection for Time Series Data with Generative Adversarial Networks"

[pdf](https://arxiv.org/pdf/1901.04997.pdf) is here.

This paper is by Dan Li (NTU), Dacheng Chen, Baihong Jin, Lei Shi, Jonathan Goh, See-Kiong Ng (NUS). This work proposed a novel Multivariate Anomaly Detection strategy with GAN (MAD-GAN) to model the complex multivariate correlations among the multiple data streams to detect anomalies using both the GAN-trained generator and discriminator. The work also propose a novel anomaly score that combines the discrimination results and reconstruction residuals for each testing sample.


### Motivation
With the emergence of the IoT, networked sensors and actuators in Cyber-Physical Systems (CPSs) will become more prevalent. To prevent those mission-critical sensors from cyber-attacks, it is of significance to closely monitor their behaviors through anomaly detection using the multivariate time series data generated by the system.

1. Traditionally, Statistical Process Control (SPC) methods such as CUSUM, EWMA and Shewhart charts were popular solutions for monitoring quality of industrial processes to find out working states that are out of range. But they cannot deal with multivariate data streams.

2. Due to the inherent lack of labeled data, anomaly detection is typically treated as an unsupervised machine learning task. However, most existing unsupervised methods are built through linear projection and transformation that is unable to handle non-linearity in the hidden inherent correlations of the multivariate time series.

3. The early successes of GAN in generating realistic complex datasets (produce polyphonic music with RNN as generator and discriminator; generate real-valued medical time series using an conditional version of recurrent GAN), as well as the simultaneous training of both a generator and a discriminator in an adversarial fashion, are highly suggestive of the use of the GAN framework for anomaly detection.

### Related Work
**Four categories of unsupervised detection methods:**
1. **Linear model-based methods**
**Principal Component Analysis (PCA)** and **Partial Least Square (PLS)** are techniques that reduce the number of explanatory variables to a smaller set of uncorrelated variables. They are used to overcome the problem of collinearity in linear regression and in cases where we have more explanatory variables than observations. PCA uses eigenvalues to find out weights of combined explanatory variables. The weights are optimized to explain as much variance as possible. The problem with PCA is that it does not use dependent variables. PLS computes weights of combined explanatory variables by also maximizing the prediction of dependent variable.

However, they are only effective for highly correlated data, and require the data to follow multivariate Gaussian distribution.

2. **Distance-based methods**
KNN, LOF... 

However, these distance-based methods perform better with priori knowledge about anomaly durations and the number of anomalies.

3. **Probabilistic and density estimation-based methods**
They are improvements of distance-based methods by paying more attention to the data distributions. 

However, these methods are unable to take into consideration the temporal correlation along time steps, and thus do not work well for multivariate time series data.

4. **Deep learning-based methods**
Auto-Encoder,LSTM Encoder-Decoder...

### Methodology
#### MAD-GAN Architecture

![ARCHITECTURE](/img/post7_Architecture.png)

All training and testing multivariate time series are divided into a set of sub-sequence by a sliding window.
**Training phase**
1. Train generator $G$ so that it can well capture the hidden multivariate distributions of the training sequences. Also, it can be viewed as an implicit model of the system at normal status.
2. Train discriminator $D$ so that it can distinguish fake data from real data with high sensitivity.

**Testing phase**
1. Invert map testing samples to latent space to get $Z^k$, use trained generator to calculate the reconstruction loss between generated sample $G(Z^k)$ and actual sample $X^{tes}$
2. Feed testing samples to trained discriminator to compute the discrimination loss.

#### DR-Score: Anomaly Detection using both Discrimination and Reconstruction
How to find the corresponding latent representation of test samples $Z^k$:
1. Sample a random set $Z^1$ from latent space and obtain reconstructed raw samples $G(Z^1)$
2. Update  samples from the latent space with the gradients obtained from the error function defined with $X^{tes}$ and $G(Z)$ as follows:

$$min_{Z^k} Er(X^{tes},G_{rnn}(Z^k))=1-Simi(X^{tes},G_{rnn}(Z^k))$$

After enough iteration rounds such that the error is small enough, the samples Z^k is recorded as the corresponding mapping in the latent space for the testing samples.

The reconstruction residual is:

$$Res(X^{tes}_t)=\sum^n_{i=1}|x^{tes,i}_t - G_{rnn}(Z_t^{k,i})|$$

The overall loss is:

$$L_t^{tes}=\lambda Res(X^{tes}_t)+(1-\lambda)D_{rnn}(X^{tes}_t)$$

Remember that time series for training and testing are divided into sub-sequence by a sliding window. Therefore, all loss shall be summed over.

### Future works
Given that this is an early attempt on multivariate anomaly detection on time series data using GAN, there are interesting issues that await further investigations. 
1. There are issues of determining the optimal subsequence length (size of the sliding window) as well as the potential model instability of the GAN approaches. May still try principle methods for theoretical guarantees.


### reference
> 1. https://arxiv.org/pdf/1901.04997.pdf 
> 2. https://www.youtube.com/watch?v=Vf7doatc2rA 